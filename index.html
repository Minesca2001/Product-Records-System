<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Punto de Venta</title>
  <link rel="stylesheet" href="bootstrap.min.css">
  <link rel="stylesheet" href="Punto_de_Venta.css">
  <!--link rel="stylesheet" href="style.css"-->
</head>

<body>
  <div class="container">
    <div class="mt-4">
      <div class="row mt-3">
        <div class="col-md-12">
          <ul class="nav nav-tabs">
            <li class="nav-item">
              <a class="nav-link active" href="#products" data-toggle="tab">Productos</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#list" data-toggle="tab">Lista de Productos</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#cart" data-toggle="tab">Carrito</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#inventory" data-toggle="tab">Inventario</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#users" data-toggle="tab">Usuarios</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#reports" data-toggle="tab">Reportes</a>
            </li>
          </ul>
          <div class="tab-content mt-3">
            <!-- Products Tab -->
            <div class="tab-pane active" id="products">
              <h3>Gestión de Productos</h3>
              <form id="productForm">
                <div class="form-group">
                  <input type="text" class="form-control" id="productName" placeholder=" " required>
                  <label for="productName">Nombre del Producto</label>
                </div>
                <div class="form-group">
                  <input type="text" class="form-control" id="productCategory" placeholder=" " required>
                  <label for="productCategory">Categoría</label>
                </div>
                <div class="form-group">
                  <input type="number" class="form-control" id="productStock" placeholder=" " required>
                  <label for="productCount">Cantidad</label>
                </div>
                <div class="form-group">
                  <input type="number" class="form-control" id="productPrice" placeholder=" " required>
                  <label for="productPrice">Precio</label>
                </div>
                <div class="form-group">
                  <input type="number" class="form-control" id="productDiscount" placeholder=" ">
                  <label for="productDiscount">Descuento</label>
                </div>
                <div class="form-group">
                  <input type="text" class="form-control" id="productBarcode" placeholder=" " required>
                  <label for="productBarcode">Código de Barras</label>
                </div>
                <div class="form-group">
                  <input type="file" class="form-control-file" id="productImage">
                  <label for="productImage">Foto del Producto</label>
                </div>
                <button type="submit" class="btn btn-primary">Registrar Producto</button>
                <button type="submit" id="saveButton" class="btn btn-primary">Guardar</button>
              </form>
            </div>
            <!-- Products List -->
            <div class="tab-pane" id="list">
              <h4 class="mt-4">Lista de Productos</h4>
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Nombre</th>
                    <th>Categoría</th>
                    <th>Cantidad</th>
                    <th>Precio</th>
                    <th>Descuento</th>
                    <th>Código de Barras</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Aquí se insertarán los productos mediante JavaScript -->
                  <tr>
                    <td>Nombre del Producto</td>
                    <td>Categoría</td>
                    <td>Cantidad</td>
                    <td>Precio</td>
                    <td>Descuento</td>
                    <td>Código de Barras</td>
                    <td>
                      <button class="btn btn-warning btn-sm" onclick="editProduct(id)">Editar</button>
                      <button class="btn btn-danger btn-sm" onclick="deleteProduct(id)">Eliminar</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- Cart Tab -->
            <div class="tab-pane" id="cart">
              <h3>Carrito de Compras</h3>
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Producto</th>
                    <th>Cantidad</th>
                    <th>Precio Unitario</th>
                    <th>Subtotal</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Aquí se insertarán los productos del carrito mediante JavaScript -->
                </tbody>
              </table>
              <div class="text-right">
                <h4>Total: $<span id="totalAmount">0.00</span></h4>
                <button class="btn btn-success">Procesar Pago</button>
              </div>
            </div>

            <!-- Inventory Tab -->
            <div class="tab-pane" id="inventory">
              <h3 class="mt-4">Gestión de Inventario</h3>
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Producto</th>
                    <th>Stock</th>
                    <th>Última Actualización</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="inventoryTable">
                  <!-- Aquí se insertarán los registros de inventario mediante JavaScript -->
                </tbody>
              </table>
            </div>
            <!-- Users Tab -->
            <div class="tab-pane" id="users">
              <h3>Gestión de Usuarios</h3>
              <form id="userForm">
                <div class="form-group">
                  <input type="text" class="form-control" id="username" placeholder=" " required>
                  <label for="username">Nombre de Usuario</label>
                </div>
                <div class="form-group">
                  <input type="password" class="form-control" id="password" placeholder=" " required>
                  <label for="password">Contraseña</label>
                </div>
                <div class="form-group">
                  <select class="form-control" id="role">
                    <option value="admin">Administrador</option>
                    <option value="cashier">Cajero</option>
                  </select>
                  <label for="role">Rol</label>
                </div>
                <button type="submit" class="btn btn-primary">Registrar Usuario</button>
              </form>
              <h4 class="mt-4">Lista de Usuarios</h4>
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Usuario</th>
                    <th>Rol</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="usersTable">
                  <!-- Aquí se insertarán los usuarios mediante JavaScript -->
                </tbody>
              </table>
            </div>

            <!-- Reports Tab -->
            <div class="tab-pane" id="reports">
              <h3>Reportes de Ventas</h3>
              <form>
                <div class="form-group">
                  <label for="reportRange">Selecciona el Rango de Fechas</label>
                  <input type="date" id="startDate" class="form-control" placeholder="Fecha de inicio">
                  <input type="date" id="endDate" class="form-control mt-2" placeholder="Fecha de fin">
                </div>
                <button type="button" class="btn btn-primary" id="generateReport">Generar Reporte</button>
              </form>
              <h4 class="mt-4">Resultados del Reporte</h4>
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Fecha</th>
                    <th>Total Ventas</th>
                    <th>Producto Más Vendido</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Aquí se insertarán los reportes mediante JavaScript -->
                </tbody>
              </table>
              <button class="btn btn-secondary mt-3">Exportar a PDF</button>
              <button class="btn btn-secondary mt-3">Exportar a Excel</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="Puntero_de_Venta.js"></script>
    <script src="mainff.js"></script>
    <script>
      // Manejo de productos y carrito en LocalStorage

let products = JSON.parse(localStorage.getItem('products')) || [];
let inventory = JSON.parse(localStorage.getItem('inventory')) || [];
let cart = JSON.parse(localStorage.getItem('cart')) || [];
let users = JSON.parse(localStorage.getItem('users')) || [];
let currentEditIndex = null; // Variable para controlar la edición de productos

document.getElementById("productForm").addEventListener("submit", function (e) {
  e.preventDefault();

  let product = {
    id: Date.now(), // Genera un ID único para el producto
    name: document.getElementById("productName").value,
    category: document.getElementById("productCategory").value,
    stock: document.getElementById("productStock").value,
    price: document.getElementById("productPrice").value,
    discount: document.getElementById("productDiscount").value,
    barcode: document.getElementById("productBarcode").value
  };

  if (currentEditIndex === null) {
    // Si currentEditIndex es null, es un producto nuevo
    products.push(product);
  } else {
    // Si currentEditIndex tiene un valor, actualiza el producto existente
    products[currentEditIndex] = product;
    currentEditIndex = null; // Restablecer el índice después de editar
    document.getElementById("saveButton").innerText = "Guardar"; // Restaurar el texto del botón
  }

  // Guardar los productos en localStorage
  localStorage.setItem('products', JSON.stringify(products, inventoryTable));

  // Renderizar la lista de productos y limpiar el formulario
  renderProducts();
  renderInventory();
  e.target.reset();
});

// Renderiza los productos en la tabla de productos
function renderProducts() {
  let tbody = document.querySelector("#list tbody");
  tbody.innerHTML = "";

  products.forEach((product, index) => {
    tbody.innerHTML += `
<tr>
  <td>${product.name}</td>
  <td>${product.category}</td>
  <td>${product.stock}</td>
  <td>${product.price}</td>
  <td>${product.discount}</td>
  <td>${product.barcode}</td>
  <td>
    <button class="btn btn-warning btn-sm" onclick="editProduct(${index})">Editar</button>
    <button class="btn btn-danger btn-sm" onclick="deleteProduct(${index})">Eliminar</button>
    <button class="btn btn-success btn-sm" onclick="addProductToCartFromList(${index})">Agregar al Carrito</button>
  </td>
</tr>

`;
  });
}

function renderInventory() {
  let tbody = document.getElementById("inventoryTable");
  tbody.innerHTML = "";

  inventory.forEach((product, index) => {
    tbody.innerHTML += `
    <tr>
      <td>${product.name}</td>
      <td>${product.stock}</td>
      <td>${new Date().toLocaleDateString()}</td>
      <td>
        <button class="btn btn-warning btn-sm" onclick="editProduct(${index})">Editar</button>
    <button class="btn btn-danger btn-sm" onclick="deleteProduct(${index})">Eliminar</button>
    </td>
    </tr>`;
  });
}

// Editar producto
function editProduct(index) {
  let product = products[index];

  document.getElementById("productName").value = product.name;
  document.getElementById("productCategory").value = product.category;
  document.getElementById("productPrice").value = product.price;
  document.getElementById("productDiscount").value = product.discount;
  document.getElementById("productBarcode").value = product.barcode;

  currentEditIndex = index; // Almacena el índice del producto que se va a editar
  document.getElementById("saveButton").innerText = "Actualizar Producto"; // Cambia el texto del botón
}

// Eliminar producto
function deleteProduct(index) {
  products.splice(index, 1); // Elimina el producto del array

  // Actualiza LocalStorage
  localStorage.setItem('products', JSON.stringify(products));

  // Vuelve a renderizar la lista de productos
  renderProducts();
}

document.getElementById("userForm").addEventListener("submit", function (e) {
  e.preventDefault();

  const user = {
    id: Date.now(),
    username: document.getElementById("username").value,
    password: document.getElementById("password").value,
    role: document.getElementById("role").value
  };

  if (currentEditIndex === null) {
    // Si no estamos editando, agrega un nuevo usuario
    users.push(user);
  } else {
    // Si estamos editando, actualiza el usuario
    users[currentEditIndex] = user;
    currentEditIndex = null;
    document.querySelector('button[type="submit"]').innerText = 'Registrar Usuario';
  }

  // Guardar los usuarios en localStorage
  localStorage.setItem('users', JSON.stringify(users));

  // Renderizar los usuarios y limpiar el formulario
  renderUsers();
  e.target.reset();
});

function renderUsers() {
  const tbody = document.getElementById("usersTable");
  tbody.innerHTML = "";

  users.forEach((user, index) => {
    tbody.innerHTML += `
      <tr>
        <td>${user.username}</td>
        <td>${user.role}</td>
        <td>
          <button onclick="editUser(${index})">Editar</button>
          <button onclick="deleteUser(${index})">Eliminar</button>
        </td>
      </tr>
    `;
  });
}

function editUser(index) {
  const user = users[index];

  document.getElementById("username").value = user.username;
  document.getElementById("password").value = user.password;
  document.getElementById("role").value = user.role;

  currentEditIndex = index;
  document.querySelector('button[type="submit"]').innerText = 'Actualizar Usuario';
}

function deleteUser(index) {
  users.splice(index, 1);
  localStorage.setItem('users', JSON.stringify(users));
  renderUsers();
}

// Llamar la función para mostrar los usuarios al cargar la página
renderUsers();
// Agregar producto al carrito desde la lista de productos
function addProductToCartFromList(index) {
  let product = products[index];
  let cartItem = cart.find(item => item.id === product.id);

  if (cartItem) {
    cartItem.quantity += 1; // Si ya existe en el carrito, aumenta la cantidad
  } else {
    cart.push({ ...product, quantity: 1 }); // Si no existe, lo agrega al carrito
  }

  // Guarda el carrito en LocalStorage
  localStorage.setItem('cart', JSON.stringify(cart));

  // Renderiza el carrito
  renderCart();
}


// Renderizar productos del carrito
function renderCart() {
  let cartTbody = document.querySelector("#cart tbody");
  cartTbody.innerHTML = "";
  let totalAmount = 0;

  cart.forEach((item, index) => {
    let subtotal = item.price * item.quantity;
    totalAmount += subtotal;

    cartTbody.innerHTML += `
<tr>
  <td>${item.name}</td>
  <td>${item.quantity}</td>
  <td>${item.price}</td>
  <td>${subtotal.toFixed(2)}</td>
  <td>
    <button class="btn btn-danger btn-sm" onclick="removeFromCart(${index})">Eliminar</button>
  </td>
</tr>
`;
  });

  // Actualiza el total en la interfaz
  document.getElementById("totalAmount").innerText = totalAmount.toFixed(2);
}

// Agregar producto al carrito
function addToCart(index) {
  let product = products[index];
  let cartItem = cart.find(item => item.id === product.id);

  if (cartItem) {
    cartItem.quantity += 1; // Si ya existe en el carrito, incrementa la cantidad
  } else {
    cart.push({ ...product, quantity: 1 });
  }

  // Guarda el carrito en LocalStorage
  localStorage.setItem('cart', JSON.stringify(cart));

  // Renderiza el carrito
  renderCart();
}

// Eliminar producto del carrito
function removeFromCart(index) {
  cart.splice(index, 1); // Elimina el producto del carrito

  // Actualiza LocalStorage
  localStorage.setItem('cart', JSON.stringify(cart));

  // Vuelve a renderizar el carrito
  renderCart();
}

// Procesar pago (vacía el carrito)
function processPayment() {
  cart = [];
  localStorage.removeItem('cart'); // Borra el carrito del almacenamiento
  renderCart();
}

// Inicializa las funciones al cargar la página
document.addEventListener("DOMContentLoaded", () => {
  renderProducts();
  renderCart();
});
// Guardar productos en LocalStorage
function saveProducts() {
  localStorage.setItem('inventory', JSON.stringify(products));
}

// Cargar productos desde LocalStorage
function loadProducts() {
  const storedProducts = localStorage.getItem('products');
  if (storedProducts) {
    products = JSON.parse(storedProducts);
  }
}

// Llama a loadProducts() al iniciar la página
loadProducts();
renderProducts(); // Renderiza los productos al cargar la página
renderInventory();
    </script>
</body>

</html>



